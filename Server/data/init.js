import mongoose from 'mongoose'
import bcrypt from 'bcryptjs'
import Admin from '../models/admin.js'
import dotenv from 'dotenv'
import path from "path";

dotenv.config({ path: path.resolve("../.env") })

const MONGO_URL = process.env.ATLAS_DB_URL || 'mongodb://127.0.0.1:27017/tba';

const connectDB = async () => {
    await mongoose.connect(MONGO_URL)
}

connectDB()
    .then(async () => {
        console.log("Connected To MongoDB")
    })
    .catch((err) => {
        console.log(err)
    })

const initDB = async () => {
    try {
        if (!process.env.ADMIN_PASSWORD || !process.env.ADMIN_USERNAME) {
            throw new Error("ADMIN_Name or ADMIN_Pass is missing in .env");
        }
        
        const hashedPassword = await bcrypt.hash(process.env.ADMIN_PASSWORD , 10)
        await Admin.create ({
            username : process.env.ADMIN_USERNAME,
            password : hashedPassword
        })
    }
    catch (err) {
        console.error("‚ùå Error initializing data:", err);
    }
}

await initDB()